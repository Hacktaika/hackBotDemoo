# Hacktaika Bot

Telegram бот на Python с aiogram для управления контентом, подарками и рассылками.

## Структура проекта

```
hacktaika-bot/
├── bot.py                 # Главный файл запуска
├── config.py             # Конфигурация
├── requirements.txt      # Зависимости
├── .env.example          # Пример конфигурации
├── database/
│   ├── __init__.py
│   ├── db.py            # Работа с БД
│   └── models.py        # Модели данных
├── handlers/
│   ├── __init__.py
│   ├── start.py         # Обработчик /start и опросника
│   ├── menu.py          # Главное меню
│   ├── content.py       # Контент по ключевым словам
│   └── admin.py         # Админ-панель
└── utils/
    └── validators.py    # Валидация и проверки
```

## Установка

1. Клонируйте репозиторий
2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Скопируйте `.env.example` в `.env` и заполните:
```
BOT_TOKEN=your_telegram_bot_token_here
ADMIN_IDS=123456789,987654321
CHANNEL1_ID=-1001234567890
CHANNEL2_ID=-1001234567891
CHANNEL1_USERNAME=@channel1
CHANNEL2_USERNAME=@channel2
SITE_URL=https://example.com
DB_PATH=./data/bot.db
```

**Как получить ID канала:**
- Добавьте бота @userinfobot в канал
- Или используйте @RawDataBot
- ID канала обычно имеет формат `-100XXXXXXXXXX`

**ВАЖНО:** Бот должен быть добавлен в оба канала как **администратор** с правами на просмотр участников!

## Запуск

```bash
python bot.py
```

## Запуск через вебхуки (подготовка к Vercel)

В репозитории добавлена webhook-версия бота для деплоя на Vercel:

- `webhook_app.py` — общая инициализация бота и функция `process_update`, которая обрабатывает один апдейт Telegram.
- `api/webhook.py` — serverless-эндпоинт для Vercel, вызывающий `process_update`.
- `vercel.json` — базовая конфигурация функции на Vercel.

Как использовать с Vercel (общая схема):

1. **Залей репозиторий на GitHub / GitLab / Bitbucket**.
2. **Подключи репозиторий к Vercel** и задеплой.
3. **В настройках проекта на Vercel** задай переменные окружения:
   - `BOT_TOKEN` и остальные из `.env` (DB_PATH и т.д.).
4. После развёртывания получишь URL вида:
   - `https://your-project.vercel.app/api/webhook`
5. **Настрой вебхук в Telegram**:
   - Выполни запрос (можно просто открыть в браузере):
   - `https://api.telegram.org/bot<ТОКЕН>/setWebhook?url=https://your-project.vercel.app/api/webhook`
   - Подставь свой токен и реальный домен проекта.

`bot.py` по-прежнему можно запускать локально через polling (`python bot.py`), а для продакшен-хостинга на Vercel использовать вебхуки через `api/webhook.py`.

## Функционал

### Для пользователей:
- Опросник при первом запуске (5 вопросов)
- Проверка подписки на 2 канала
- Главное меню с информационными разделами
- Получение подарков и бонусов
- Викторина (заглушка)
- Автоматическая отправка контента по ключевым словам

### Для администраторов:
- Рассылка всем пользователям
- Добавление контента по ключевым словам
- Статистика пользователей

## Админ-команды

- `/admin` - Открыть админ-панель
- `/cancel` - Отменить текущую операцию

## Технологии

- Python 3.10+
- aiogram 3.4.1
- SQLAlchemy (SQLite)
- Pydantic для валидации
