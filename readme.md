# Hacktaika Bot

Telegram бот на Python с aiogram для управления контентом, подарками и рассылками.

## Структура проекта

```
hacktaika-bot/
├── bot.py                 # Главный файл запуска
├── config.py             # Конфигурация
├── requirements.txt      # Зависимости
├── .env.example          # Пример конфигурации
├── database/
│   ├── __init__.py
│   ├── db.py            # Работа с БД
│   └── models.py        # Модели данных
├── handlers/
│   ├── __init__.py
│   ├── start.py         # Обработчик /start и опросника
│   ├── menu.py          # Главное меню
│   ├── content.py       # Контент по ключевым словам
│   └── admin.py         # Админ-панель
└── utils/
    └── validators.py    # Валидация и проверки
```

## Установка

1. Клонируйте репозиторий
2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Скопируйте `.env.example` в `.env` и заполните:
```
BOT_TOKEN=your_telegram_bot_token_here
ADMIN_IDS=123456789,987654321
CHANNEL1_ID=-1001234567890
CHANNEL2_ID=-1001234567891
CHANNEL1_USERNAME=@channel1
CHANNEL2_USERNAME=@channel2
SITE_URL=https://example.com
DB_PATH=./data/bot.db
```

**Как получить ID канала:**
- Добавьте бота @userinfobot в канал
- Или используйте @RawDataBot
- ID канала обычно имеет формат `-100XXXXXXXXXX`

**ВАЖНО:** Бот должен быть добавлен в оба канала как **администратор** с правами на просмотр участников!

## Запуск

### Локальный запуск

```bash
python bot.py
```

### Запуск через Docker

Проект настроен для запуска в Docker-контейнере с кастомными портами.

#### Быстрый старт:

1. **Убедись, что у тебя установлены Docker и Docker Compose:**
   ```bash
   docker --version
   docker-compose --version
   ```

2. **Создай файл `.env`** (если ещё не создан) на основе `.env.example` и заполни все переменные.

3. **Собери и запусти контейнер:**
   ```bash
   docker-compose up -d --build
   ```

4. **Проверь логи:**
   ```bash
   docker-compose logs -f
   ```

#### Управление контейнером:

- **Остановить бота:**
  ```bash
  docker-compose stop
  ```

- **Перезапустить бота:**
  ```bash
  docker-compose restart
  ```

- **Остановить и удалить контейнер:**
  ```bash
  docker-compose down
  ```

- **Посмотреть статус:**
  ```bash
  docker-compose ps
  ```

#### Настройка портов:

В `docker-compose.yml` можно изменить порты под свои нужды:
```yaml
ports:
  - "8888:8888"  # Измени на нужный порт
```

**Важно:**
- Данные БД сохраняются в директории `./data` на хосте (монтируется как volume)
- Все переменные окружения читаются из файла `.env`
- Контейнер автоматически перезапускается при падении (`restart: unless-stopped`)

## Функционал

### Для пользователей:
- Опросник при первом запуске (5 вопросов)
- Проверка подписки на 2 канала
- Главное меню с информационными разделами
- Получение подарков и бонусов
- Викторина (заглушка)
- Автоматическая отправка контента по ключевым словам

### Для администраторов:
- Рассылка всем пользователям
- Добавление контента по ключевым словам
- Статистика пользователей

## Админ-команды

- `/admin` - Открыть админ-панель
- `/cancel` - Отменить текущую операцию

## Технологии

- Python 3.10+
- aiogram 3.4.1
- SQLAlchemy (SQLite)
- Pydantic для валидации
